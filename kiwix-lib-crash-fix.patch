From 2c465b88aedcda959c6eff53bab9d672ae3db1aa Mon Sep 17 00:00:00 2001
From: Yaroslav Sidlovsky <zawertun@otl.ru>
Date: Tue, 25 Aug 2020 20:58:27 +0300
Subject: [PATCH] Resetting CURLOPT_ERRORBUFFER before calling Aria2::doRequest

fix for https://github.com/kiwix/kiwix-desktop/issues/513
(Kiwix always crashing after exit on Fedora)
---
 src/aria2.cpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/aria2.cpp b/src/aria2.cpp
index efa9e3f..6dbe3ed 100644
--- a/src/aria2.cpp
+++ b/src/aria2.cpp
@@ -111,6 +111,9 @@ Aria2::Aria2():
     curl_easy_cleanup(mp_curl);
     throw std::runtime_error("Cannot connect to aria2c rpc. Aria2c launch cmd : " + launchCmd);
   }
+
+  // Resetting CURLOPT_ERRORBUFFER to the default value
+  curl_easy_setopt(mp_curl, CURLOPT_ERRORBUFFER, nullptr);
 }
 
 Aria2::~Aria2()
